<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ByteTalk - Llamando..</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Exo+2:wght@800&family=Saira+Stencil+One&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/Videollamada.css">
        <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">       
    </head>
<body>
    
    <div class="video-call-container">
        <!-- Usuario -->
        <div class="video-container">
            <video id="local-video" autoplay muted></video>
        </div>

        <!-- Contacto -->
        <div class="video-container">
            <video id="remote-video" autoplay></video>
        </div>
    </div>

    <!-- Controles -->
    <div class="call-controls">
        <button id="mute-btn" class="control-btn">
            <i class="bx bxs-microphone"></i>
        </button>
        <button id="camera-btn" class="control-btn">
            <i class="bx bxs-video"></i>
        </button>
        <a href="/Chat.html" id="end-call-btn" class="control-btn end-call">
            <i class="bx bxs-phone-off"></i>
        </a>
    </div>

    <script>
        // Micrófono
        document.getElementById("mute-btn").addEventListener("click", function () {
            let icon = this.querySelector("i");
            icon.classList.toggle("bxs-microphone");
            icon.classList.toggle("bxs-microphone-off");
        });

        // Cámara
        document.getElementById("camera-btn").addEventListener("click", function () {
            let icon = this.querySelector("i");
            icon.classList.toggle("bxs-video");
            icon.classList.toggle("bxs-video-off");
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Extraer ID del usuario destino desde la URL
    const urlParams = new URLSearchParams(window.location.search);
    const targetId = urlParams.get('id');

    // Verificar si ya estamos en la videollamada antes de ejecutar startCall
    const currentPage = window.location.pathname.includes("Videollamada.html");

    if (targetId && targetId.trim() !== "" && !currentPage) {
        startCall(targetId);
    } else {
        console.error("❌ Error: targetId no válido o usuario ya en la videollamada.");
    }
</script>

<script src="/videollamada.js"></script>

</body>
</html>